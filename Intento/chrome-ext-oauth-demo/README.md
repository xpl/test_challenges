# –î–µ–º–æ (—Å–∫—Ä–∏–Ω–∫–∞—Å—Ç)

#### üëâ https://www.youtube.com/watch?v=3n5WQEkSwrA

# –ö–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å (dev build)

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

–°–Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–µ–∫–µ–Ω–¥-—Å–µ—Ä–≤–∏—Å (–ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è **Node.js**):

```
cd service
npm install
npm start
```

–ï—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–π–¥—ë—Ç —É–¥–∞—á–Ω–æ, –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ:

```
Demo Service is running at port 31337
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

1. –ò–¥—ë–º –≤ `chrome://extensions/`
2. –ñ–º—ë–º _Load unpacked_
3. –í—ã–±–∏—Ä–∞–µ–º –ø–∞–ø–∫—É `chrome-ext`

–ï—Å–ª–∏ –≤—Å—ë –ø—Ä–æ–π–¥—ë—Ç —É–¥–∞—á–Ω–æ ‚Äî –º—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –∏–∫–æ–Ω–∫—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –≤ —Ç—É–ª–±–∞—Ä–µ:

<img width="489" alt="Screen Shot 2020-02-13 at 19 54 29" src="https://user-images.githubusercontent.com/1707/74461818-30e0e380-4ea0-11ea-8347-12d9a247a436.png">

# –ö–∞–∫ —ç—Ç–æ —É—Å—Ç—Ä–æ–µ–Ω–æ

1. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ "Sign in" –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ö—Ä–æ–º–æ–≤—Å–∫–∏–π OAuth-—Ö–µ–ª–ø–µ—Ä `launchWebAuthFlow`
2. –¢–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ø–∞–ø-–æ–∫–Ω–æ —Å –ª–æ–≥–∏–Ω-—Ñ–æ—Ä–º–æ–π –≥–∏—Ç—Ö–∞–±–∞ (–µ—Å–ª–∏ –º—ã –µ—â—ë –Ω–µ –±—ã–ª–∏ –≤ –Ω—ë–º –∑–∞–ª–æ–≥–∏–Ω–µ–Ω—ã)
3. –ü—Ä–∏ —É—Å–ø–µ—Ö–µ –æ—Ç—Ç—É–¥–∞ –Ω–∞–º –ø—Ä–∏—Ö–æ–¥–∏—Ç –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π –∫–æ–¥
4. –ö–æ–¥ –ø–æ—Å—ã–ª–∞–µ—Ç—Å—è –≤ –Ω–∞—à —Å–µ—Ä–≤–∏—Å —á–µ—Ä–µ–∑ `/api/login`
5. –°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥—ä—è–≤–ª—è–µ—Ç —ç—Ç–æ—Ç –∫–æ–¥ –≥–∏—Ç—Ö–∞–±—É, –ø–æ–ª—É—á–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω
6. –¢–æ–∫–µ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–µ—Ä–≤–∏—Å–æ–º –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (email, –∏–º—è, —é–∑–µ—Ä–ø–∏–∫)
7. –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î —Å–µ—Ä–≤–∏—Å–∞ (—Ç–∏–ø–∞ –º—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å)
8. –°–æ–∑–¥–∞—ë—Ç—Å—è —Å–µ—Å—Å–∏–æ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω, –∞—Å—Å–æ—Ü–∏–∏—Ä—É–µ—Ç—Å—è —Å email, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é
9. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω –¥–ª—è –¥–µ—Ä–≥–∞–Ω–∏—è –¥—Ä—É–≥–∏—Ö API —Å–µ—Ä–≤–∏—Å–∞ (`/api/profile`)
10. –ü–æ–ª—É—á–µ–Ω–Ω–∞—è –∏–Ω—Ñ–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ, —Ç–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `chrome.storage`

<img width="441" alt="Screen Shot 2020-02-13 at 20 33 56" src="https://user-images.githubusercontent.com/1707/74461862-3dfdd280-4ea0-11ea-933e-75e57a37a301.png">

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

–°–Ω–∞—á–∞–ª–∞ –æ–Ω–∞ –±—ã–ª–∞ –ø—Ä–æ—Å—Ç–æ–π –∞–∫–∏ —Ö–µ–ª–ª–æ—É–≤–æ—Ä–ª–¥, –Ω–æ –∑–∞—Ç–µ–º –≤—ã—è—Å–Ω–∏–ª—Å—è –ø—Ä–µ–Ω–µ–ø—Ä–∏—è—Ç–Ω–µ–π—à–∏–π –º–æ–º–µ–Ω—Ç ‚Äî –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–æ–ø–∞–ø–∞, –ø–æ–ø–∞–ø —Å–∞–º–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è, –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö promise chains –≤ `popup.js` –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è. –ü–æ—ç—Ç–æ–º—É –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –≤—Å—é –ª–æ–≥–∏–∫—É –ª–æ–≥–∏–Ω–∞ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –≤ _background-—Å–∫—Ä–∏–ø—Ç–µ_. –í–µ—Å—å state management —Ç–æ–∂–µ –ø—Ä–∏—à–ª–æ—Å—å —É–±—Ä–∞—Ç—å —Ç—É–¥–∞ –ø–æ —Ç–æ–π –∂–µ –ø—Ä–∏—á–∏–Ω–µ ‚Äî –∏–Ω–∞—á–µ —Å—Ç–µ–π—Ç —É–Ω–∏—á—Ç–æ–∂–∞–ª—Å—è –±—ã –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ–ø–∞–ø–∞ –∏ –≤—Å–µ –Ω–∞—à–∏ loading-—Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Ö–µ—Ä–∏–ª–∏—Å—å –±—ã. –í –∏—Ç–æ–≥–µ –∏–º–µ–µ–º:

1. `background.js` ‚Äî ¬´–±–µ–∫–µ–Ω–¥¬ª (–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è + –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –ª–æ–≥–∏–Ω–∞)
2. `popup.js` ‚Äî ¬´—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥¬ª (—Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –∫–ª–∏–∫-—Ö–µ–Ω–¥–ª–µ—Ä—ã, –∏–Ω–∏—Ü–∏–∞—Ü–∏—è OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

## ¬´–°–µ—Ä–≤–∏—Å¬ª

–ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∏–∑ —Å–µ–±—è –ø—Ä–æ—Å—Ç–æ–π express-—Å–µ—Ä–≤–µ—Ä –∏–º–µ—é—â–∏–π –¥–≤–∞ –µ–Ω–¥–ø–æ–π–Ω—Ç–∞:

### POST `/api/login`

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `provider` (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `github`)
- `code` ‚Äî –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º—ã –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ –æ—Ç –≥–∏—Ç—Ö–∞–±–∞

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (–ø—Ä–∏–º–µ—Ä):

```javascript
{ authToken: '9f574b1bad5e49e2b55d356488a0a3945ac1f7b1' }
```

–¢–æ–∫–µ–Ω –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–µ—Å—Å–∏–∏ (–∑–∞–≤–µ–¥—ë–Ω–Ω–æ–π –≤–Ω—É—Ç—Ä–∏ —Å–µ—Ä–≤–∏—Å–∞), —Å–≤—è–∑–∞–Ω–Ω–æ–π —Å email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. Email –∏ –¥—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –º—ã –¥–µ—Ä–≥–∞–µ–º —Å –≥–∏—Ç—Ö–∞–±–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, —Å–æ—Ö—Ä–∞–Ω—è—è –≤—Å—ë —ç—Ç–æ –¥–µ–ª–æ –≤ ¬´–ë–î¬ª (–µ—ë –∏–º–∏—Ç–∞—Ü–∏—é –Ω–∞ json-—Ñ–∞–π–ª–∏–∫–∞—Ö, —Å–º. `service/db.js`)

### GET `/api/profile`

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `authToken` —Ç–æ–∫–µ–Ω –∫–æ—Ç–æ—Ä—ã–π –º—ã —Ä–∞–Ω–µ–µ –ø–æ–ª—É—á–∏–ª–∏ –∏–∑ `/api/login`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (–Ω–µ–∫–∞—è —É—Å–ª–æ–≤–Ω–∞—è —Ö–µ—Ä—å –∫–æ—Ç–æ—Ä—É—é –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è —Ö—Ä–∞–Ω–∏—Ç —Å–µ—Ä–≤–∏—Å):

```javascript
{ email: 'rocket.mind@gmail.com', name: 'Vitaly Gordon', picture: 'https://..." }
```

# Maintenance

### –ú–µ–Ω—è–µ–º OAuth-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–∏–ª–∏ –µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ GitHub, –Ω–æ –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –≤—Å—ë –ø–ª—é—Å-–º–∏–Ω—É—Å —Ç–æ –∂–µ —Å–∞–º–æ–µ:

1. –ò–¥—ë–º –≤ https://github.com/settings/applications/new

2. –í –∫–∞—á–µ—Å—Ç–≤–µ **callback URL** –º—ã –¥–æ–ª–∂–Ω—ã —É–∫–∞–∑–∞—Ç—å `https://<id>.chromiumapp.org/` –≥–¥–µ `<id>` —ç—Ç–æ –∫–ª—é—á –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∏–∑ `key.pem` —Ñ–∞–π–ª–∞, –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —ç—Ç–æ `hdlghbjhnakngfafchpgmfdpldefiokc`. –ö–∞–∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî —Å–º. —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ä–∞–∑–¥–µ–ª –Ω–∏–∂–µ.

3. –°–æ—Ö—Ä–∞–Ω—è–µ–º **client id** –∏ **secret** –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–º –≤—ã–¥–∞—Å—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä.

4. –í–ø–∏—Å—ã–≤–∞–µ–º `client_id` –∏ `secret` –≤ `service/index.js`

5. –í–ø–∏—Å—ã–≤–∞–µ–º `client_id` –≤ `chrome-ext/popup.js` –≤ —Ñ—É–Ω–∫—Ü–∏—é `getAuthCodeFromGitHub`

### WTF is `key.pem`?

–≠—Ç–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è. –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å (–µ—Å–ª–∏ –≤–∞–º —ç—Ç–æ –∑–∞—á–µ–º-—Ç–æ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è) –µ–≥–æ –º–æ–∂–Ω–æ —Ç–∞–∫:

```
openssl genrsa 2048 | openssl pkcs8 -topk8 -nocrypt -out key.pem
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª–µ `key` –≤ `manifest.json` ‚Äî —ç—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á. –ü–æ–ª—É—á–∏—Ç—å –µ–≥–æ –º–æ–∂–Ω–æ —Ç–∞–∫:

```
openssl rsa -in key.pem -pubout -outform DER | openssl base64 -A
```

–ß—Ç–æ–±—ã –≤–∞–º —ç—Ç–æ–≥–æ –Ω–µ –ø–æ–∫–∞–∑–∞–ª–æ—Å—å –º–∞–ª–æ, –Ω—É–∂–Ω–æ –µ—â—ë –∏ –ø–æ–º–µ–Ω—è—Ç—å **callback (redirect) URL** –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ç–æ–≥–æ OAuth-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞, –≥–¥–µ –º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏ –Ω–∞—à —Å–µ—Ä–≤–∏—Å ‚Äî –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ GitHub. –ü–æ–º–µ–Ω—è—Ç—å –Ω–∞ `https://<id>.chromiumapp.org/` –≥–¥–µ `<id>` —ç—Ç–æ –∞—É—Ç–ø—É—Ç —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–º–∞–Ω–¥—ã:

```
openssl rsa -in key.pem -pubout -outform DER |  shasum -a 256 | head -c32 | tr 0-9a-f a-p
```
